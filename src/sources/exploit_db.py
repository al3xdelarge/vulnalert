import requests

from source_classes.rss import RSS
from utils.statics import TYPE_EXPLOIT, LANGUAGE_ENGLISH


class ExploitDatabase(RSS):
    name = 'exploit.db'
    url = 'https://www.exploit-db.com/rss.xml'
    main_type = TYPE_EXPLOIT
    language = LANGUAGE_ENGLISH

    def process_articles(self):
        processed_articles = list()
        for article in self.articles:
            # exclude local exploits
            if '[local]' in article.full_title:
                continue

            # exclude software from sourcecodester.com
            try:
                r = requests.get(
                    article.url.replace('/exploits/', '/download/'),
                    headers={'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0'},
                    timeout=5)
            except requests.RequestException:
                r = None
            if r:
                if 'sourcecodester.com' in r.text:
                    continue

            processed_articles.append(article)
        self.articles = processed_articles

